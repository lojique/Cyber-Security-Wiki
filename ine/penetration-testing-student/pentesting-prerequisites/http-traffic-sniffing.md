# HTTP Traffic Sniffing

## HTTP Traffic Sniffing

In this lab you will intercept traffic with _Wireshark_ (a common sniffer tool) and analyze it.

This exercise will help you understand the fundamental difference between **clear-text (HTTP) and encrypted (HTTPS)** data transmission.

## Lab Environment

In this lab environment, the user is going to get access to a Kali GUI instance. There are two instances of bWAPP web application hosted on two different servers that can be accessed using the tools installed on Kali.

* bWAPP (On HTTP): http://demo.ine.local
* bWAPP (On HTTPS): https://demossl.ine.local

**Objective:** Use Wireshark to sniff the traffic for both portals and learn the difference!

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/0.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/0.png)

bWAPP Login Information:

* Username: **bee**
* Password: **bug**

## Instructions

* Use **eth1** interface of Kali instance to monitor the traffic between bWAPP instances and Kali
* Use **wireshark -i eth1** command on terminal to start Wireshark in order to sniff on interface eth1

## Tools

The best tools for this lab are:

* Wireshark
* A web browser

**Please go ahead ONLY if you have COMPLETED the lab or you are stuck! Checking the solutions before actually trying the concepts and techniques you studied in the course, will dramatically reduce the benefits of a hands-on lab!**

## Solution

**Step 1:** Open the lab link to access the Kali GUI instance.

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/1.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/1.png)

**Step 2:** Check if both machines/domains are reachable.

**Command**

```
ping demo.ine.local
ping demossl.ine.local
```

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/2.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/2.png)

Both machines are reachable.

**Step 3:** Check open ports on both machines.

**Command**

```
nmap demo.ine.local
nmap demossl.ine.local
```

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/3.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/3.png)

On first machine, port 80 (HTTP Service) is open whereas on second machine, port 443 (HTTP over TLS) is also open. On both machines, port 3306 (MySQL) is also open.

**Step 4:** Check the interfaces present on the Kali machine.

**Command**

```
ifconfig
```

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/4.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/4.png)

There are two interfaces (excluding loopback interface) present on the machine i.e. eth0 and eth1.

**Step 5:** Start wireshark on interface eth1.

**Command**

```
wireshark -i eth1
```

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/5.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/5.png)

**Step 6:** Open web browser and browse to **demo.ine.local**.

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/6\_1.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/6\_1.png)

Once the page is loaded, switch back to Wireshark and check captured traffic.

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/6\_1.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/6\_1.png)

One can observe HTTP packets in the capture. The content of these packets is in human readable form and it is possible to reconstruct the whole request/response by combining multiple TCP packets. Select a TCP/HTTP packet, use **right-click** menu to select **Follow > TCP Stream**.

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/6\_2.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/6\_2.png)

This will combine relevant packets and show us a request and response.

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/6\_3.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/6\_3.png)

**Step 7:** Login to the web app using provided credentials i.e. username: bee and password: bug.

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/7.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/7.png)

We can find out the packet containing login form submission using the following filter:

```
http contains bee
```

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/7\_1.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/7\_1.png)

**It is clear that everything transferred over HTTP is prone to interception.**

**Step 8:** Restart the capture on Wireshark!

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/8.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/8.png)

**Step 9:** Switch to web browser and browse to **demossl.ine.local**.

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/9.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/9.png)

This portal is on HTTPS (HTTP over TLS), the details of connection and certificate can be checked by clicking on the lock icon shown in the address bar.

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/9\_1.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/9\_1.png)

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/9\_2.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/9\_2.png)

**Step 10:** Login to the web app using provided credentials i.e. username: bee and password: bug.

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/10.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/10.png)

Switch back to Wireshark and check captured traffic. Filter the traffic for HTTP packets using the following filter:

```
http
```

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/10\_1.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/10\_1.png)

The only HTTP packets in the capture are related to 302 redirect that our browser received when we tried to access demossl.ine.local over HTTP instead of HTTPS.

If we filter the traffic for TLS packets, we will be able to observe the complete TLS handshake and encrypted application data packets.

Filter:

```
tls
```

**Step 11:** Select a TCP packet, use **right-click** menu to select **Follow > TCP Stream**.

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/11.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/11.png)

![https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/11\_1.png](https://assets.ine.com/content/pta-labs/1\_https\_traffic\_sniffing/11\_1.png)

The TCP stream is not human readable as the content is encrypted (TLS provides encryption alongwth integrity and authenticity).

**Hence, it is clear that HTTPS (HTTP over TLS) protects the content from passive interception.**
