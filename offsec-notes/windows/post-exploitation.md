# Post-Exploitation

You should approach to first machine in AD as regular standalone windows machine. Lateral movement or privilege escalation as well.

You can do post exploitation steps as follows:

Check groups where the user is in. Check the user in some privileged group.

Check another users in the domain.

Search files in the system for finding passwords, important notes and information, mail etc.

Check services on the system.

Some services contains cleartext passwords, hashes in some files.

Extract hashes, secrets, kerberos tickets with mimikatz etc. (requires system shell)

{% content-ref url="../password-extraction.md" %}
[password-extraction.md](../password-extraction.md)
{% endcontent-ref %}

Try pass the hash methods like using psexec or crackmapexec from impacket, evil-winrm, xfreerdp etc. (If the target user has not Administrator rights, you cannot get shell with impacket).

Try cracking extracted hashes.

{% content-ref url="../password-cracking/" %}
[password-cracking](../password-cracking/)
{% endcontent-ref %}

Check SPNs. If there is SPN in system, try extract and crack it.

{% content-ref url="powershell-scripts/getuserspns.ps1.md" %}
[getuserspns.ps1.md](powershell-scripts/getuserspns.ps1.md)
{% endcontent-ref %}

Check GMSA. If there is gmsa account in the system, try extract and crack it.

{% content-ref url="broken-reference" %}
[Broken link](broken-reference)
{% endcontent-ref %}

If you have cleartext password you can use Spray-Passwords.ps1 to identify the another user is using the same password.

{% content-ref url="powershell-scripts/spray-passwords.ps1.md" %}
[spray-passwords.ps1.md](powershell-scripts/spray-passwords.ps1.md)
{% endcontent-ref %}

Check the user has capabilities for exploitable GPO.

{% content-ref url="broken-reference" %}
[Broken link](broken-reference)
{% endcontent-ref %}

You can try recent AD exploits to get domain admin privileges.

## Windows

```
# pass the hash
crackmapexec smb --local-auth 10.11.1.0/24 -H ee0c207898a5bccc01f38115019ca2fb -u Administrator

# dump creds
mimi.exe "privilege::debug" "token::elevate" "sekurlsa::logonpasswords" "lsadump::sam" "exit"
```

##
